CREATE TABLE PICTURE (
    ID bigint GENERATED BY DEFAULT AS IDENTITY,
    NAME VARCHAR(255) NOT NULL,
    WIDTH INT NOT NULL,
    HEIGHT INT NOT NULL,
    CONTENT BLOB NOT NULL,
    CONTENT_TYPE VARCHAR(255),
    REFERENCE_CODE VARCHAR(255), -- This could be unique in databases that can create a unique index on nullable fields

    CREATED_AT TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP NOT NULL,
    ENTITY_VERSION BIGINT NOT NULL,

    PRIMARY KEY (ID)
);

CREATE TABLE PRODUCT (
    ID bigint GENERATED BY DEFAULT AS IDENTITY,
    CODE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL,
    PRICE_WITHOUT_VAT DECIMAL(16,2) NOT NULL,
    PRICE_WITH_VAT DECIMAL(16,2) NOT NULL,
    DESCRIPTION VARCHAR(4000) NULL,
    PICTURE_ID bigint NULL,

    CREATED_AT TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP NOT NULL,
    ENTITY_VERSION BIGINT NOT NULL,

    PRIMARY KEY (ID)
);

ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_CODE_UNQ UNIQUE KEY (CODE);
ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_NAME_UNQ UNIQUE KEY (NAME);
ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_PICTURE_FK FOREIGN KEY (PICTURE_ID) REFERENCES PICTURE(ID);

CREATE TABLE CUSTOMER (
    ID bigint GENERATED BY DEFAULT AS IDENTITY,
    FIRST_NAME VARCHAR(255) NOT NULL,
    LAST_NAME VARCHAR(255) NOT NULL,
    TELEPHONE VARCHAR(255),
    EMAIL VARCHAR(255),
    PICTURE_ID bigint NULL,

    CREATED_AT TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP NOT NULL,
    ENTITY_VERSION BIGINT NOT NULL,

    PRIMARY KEY (ID)
);

ALTER TABLE CUSTOMER ADD CONSTRAINT CUSTOMER_EMAIL_UNQ UNIQUE KEY (EMAIL);
ALTER TABLE CUSTOMER ADD CONSTRAINT CUSTOMER_PICTURE_FK FOREIGN KEY (PICTURE_ID) REFERENCES PICTURE(ID);

CREATE TABLE ORDR (
    ID bigint GENERATED BY DEFAULT AS IDENTITY,
    CUSTOMER_ID bigint NOT NULL,
    PRICE_WITHOUT_VAT DECIMAL(20, 2) NOT NULL,
    PRICE_WITH_VAT DECIMAL(20, 2) NOT NULL,

    CREATED_AT TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP NOT NULL,
    ENTITY_VERSION BIGINT NOT NULL,

    PRIMARY KEY (ID)
);

ALTER TABLE ORDR ADD CONSTRAINT ORDR_CUSTOMER_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(ID);

CREATE TABLE ORDER_ITEM (
    ORDER_ID bigint NOT NULL,
    PRODUCT_ID bigint NOT NULL,
    ITEM_COUNT int NOT NULL,

    PRIMARY KEY (ORDER_ID, PRODUCT_ID)
);

ALTER TABLE ORDER_ITEM ADD CONSTRAINT ORDER_ITEM_ORDER_FK FOREIGN KEY (ORDER_ID) REFERENCES ORDR(ID) ON DELETE CASCADE;
ALTER TABLE ORDER_ITEM ADD CONSTRAINT ORDER_ITEM_PRODUCT_FK FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(ID);

CREATE TABLE REVOKED_TOKEN (
    JWT_HASH VARCHAR(255) NOT NULL,
    PRIMARY KEY (JWT_HASH)
);